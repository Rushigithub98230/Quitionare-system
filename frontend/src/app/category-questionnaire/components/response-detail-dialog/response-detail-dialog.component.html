<div class="response-detail-dialog">
  <!-- Dialog Header -->
  <div class="dialog-header">
    <div class="header-content">
      <div class="header-icon">
        <mat-icon>assignment</mat-icon>
      </div>
      <div class="header-text">
        <h2 mat-dialog-title>Response Details</h2>
        <p class="subtitle">{{ data.questionnaire?.title || 'Questionnaire Response' }}</p>
      </div>
    </div>
    <button mat-icon-button (click)="close()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <!-- Response Summary Section -->
    <div class="response-summary">
      <mat-card class="summary-card">
        <mat-card-content>
          <div class="summary-header">
            <h3>
              <mat-icon>info</mat-icon>
              Response Overview
            </h3>
            <div class="completion-status">
              <mat-chip [class.completed]="data.response?.isCompleted" [class.draft]="!data.response?.isCompleted">
                <mat-icon>{{ data.response?.isCompleted ? 'check_circle' : 'schedule' }}</mat-icon>
                {{ data.response?.isCompleted ? 'Completed' : 'Draft' }}
              </mat-chip>
            </div>
          </div>
          
          <div class="summary-grid">
            <div class="summary-item">
              <div class="item-icon">
                <mat-icon>quiz</mat-icon>
              </div>
              <div class="item-content">
                <span class="label">Questionnaire</span>
                <span class="value">{{ data.questionnaire?.title || 'Unknown' }}</span>
              </div>
            </div>
            
            <div class="summary-item">
              <div class="item-icon">
                <mat-icon>category</mat-icon>
              </div>
              <div class="item-content">
                <span class="label">Category</span>
                <span class="value category-tag">{{ data.response?.categoryName || 'Unknown' }}</span>
              </div>
            </div>
            
            <div class="summary-item">
              <div class="item-icon">
                <mat-icon>person</mat-icon>
              </div>
              <div class="item-content">
                <span class="label">User</span>
                <span class="value">{{ data.response?.userName || 'Admin' }}</span>
              </div>
            </div>
            
            <div class="summary-item">
              <div class="item-icon">
                <mat-icon>schedule</mat-icon>
              </div>
              <div class="item-content">
                <span class="label">Started</span>
                <span class="value">{{ getFormattedDate(data.response?.startedAt) }}</span>
              </div>
            </div>
            
            <div class="summary-item" *ngIf="data.response?.completedAt">
              <div class="item-icon">
                <mat-icon>check_circle</mat-icon>
              </div>
              <div class="item-content">
                <span class="label">Completed</span>
                <span class="value">{{ getFormattedDate(data.response?.completedAt) }}</span>
              </div>
            </div>
            
            <div class="summary-item" *ngIf="data.response?.timeTaken">
              <div class="item-icon">
                <mat-icon>timer</mat-icon>
              </div>
              <div class="item-content">
                <span class="label">Time Taken</span>
                <span class="value">{{ data.response?.timeTaken }} minutes</span>
              </div>
            </div>
          </div>

          <!-- Progress Section -->
          <div class="progress-section" *ngIf="data.response?.questionCount">
            <div class="progress-header">
              <span class="progress-label">Completion Progress</span>
              <span class="progress-percentage">{{ getCompletionPercentage() }}%</span>
            </div>
            <mat-progress-bar 
              [value]="getCompletionPercentage()" 
              [color]="data.response?.isCompleted ? 'primary' : 'accent'"
              class="progress-bar">
            </mat-progress-bar>
            <div class="progress-stats">
              <span class="stat">{{ data.response?.answeredQuestions || 0 }} of {{ data.response?.questionCount }} questions answered</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Questions Section -->
    <div class="questions-section">
      <div class="section-header">
        <h3>
          <mat-icon>question_answer</mat-icon>
          Question Responses
        </h3>
        <span class="question-count">{{ data.response?.questionResponses?.length || 0 }} questions</span>
      </div>
      
      <div class="questions-list">
        <mat-card *ngFor="let questionResponse of data.response?.questionResponses; let i = index" 
                 class="question-card"
                 [class.answered]="isQuestionAnswered(questionResponse)"
                 [class.required]="questionResponse?.question?.isRequired">
          <mat-card-header>
            <div class="question-header">
              <div class="question-number">
                <span class="number">{{ i + 1 }}</span>
              </div>
              <div class="question-info">
                <h4 class="question-title">{{ questionResponse?.questionText || questionResponse?.question?.questionText }}</h4>
                <div class="question-meta">
                  <span class="question-type">{{ questionResponse?.questionType || questionResponse?.question?.questionTypeName }}</span>
                  <mat-chip *ngIf="questionResponse?.question?.isRequired" class="required-chip">
                    Required
                  </mat-chip>
                </div>
              </div>
              <div class="question-status">
                <mat-icon *ngIf="isQuestionAnswered(questionResponse)" class="answered-icon">check_circle</mat-icon>
                <mat-icon *ngIf="!isQuestionAnswered(questionResponse)" class="unanswered-icon">radio_button_unchecked</mat-icon>
              </div>
            </div>
          </mat-card-header>
          
          <mat-card-content>
            <div class="question-content">
              <div class="question-type">
                {{ questionResponse?.questionType || questionResponse?.question?.questionTypeName }}
              </div>
              
              <div class="response-content">
                <div class="response-value" *ngIf="isQuestionAnswered(questionResponse)">
                  <span class="value-label">Response:</span>
                  <div class="text-response">
                    {{ getResponseDisplayValue(questionResponse) }}
                  </div>
                </div>
                
                <div class="no-response" *ngIf="!isQuestionAnswered(questionResponse)">
                  <mat-icon>info</mat-icon>
                  <span>No response provided</span>
                </div>
                
                <!-- Options for multiple choice questions -->
                <div class="question-options" *ngIf="questionResponse?.question?.options?.length">
                  <div class="options-label">Available Options:</div>
                  <div class="options-grid">
                    <div *ngFor="let option of questionResponse?.question?.options" 
                         class="option-item"
                         [class.selected]="isOptionSelected(questionResponse, option)">
                      <mat-icon *ngIf="isOptionSelected(questionResponse, option)" class="option-selected">check_circle</mat-icon>
                      <mat-icon *ngIf="!isOptionSelected(questionResponse, option)" class="option-checkbox">radio_button_unchecked</mat-icon>
                      <span class="option-text">{{ option.optionText }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </mat-dialog-content>

  <!-- Dialog Actions -->
  <mat-dialog-actions align="end">
    <button mat-button (click)="close()">
      <mat-icon>close</mat-icon>
      Close
    </button>
    <button mat-raised-button color="primary" (click)="exportResponse()">
      <mat-icon>download</mat-icon>
      Export Response
    </button>
  </mat-dialog-actions>
</div> 